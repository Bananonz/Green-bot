const KongouCommand=require("../../abstract/KongouCommand.js"),KongouDispatcher=require("../../modules/KongouDispatcher.js");class Queue extends KongouCommand{get name(){return"queue"}get description(){return"Shows the current queue for this guild!"}get aliases(){return["q","songs"]}get category(){return"Everyone Commands"}get playerCheck(){return{voice:!1,dispatcher:!0,channel:!1}}async run({ctx:e}){if(e.dispatcher.queue.length>6){const t=e.dispatcher.queue.slice(0,6);let u=0,a=6,n=1;const i=await e.channel.send({embeds:[{author:{name:`Queue for ${e.guild.name} (${e.dispatcher.queue.length} songs)`,icon_url:e.author.displayAvatarURL({size:512,format:"png"})},fields:[{name:"• Now playing",value:`[${e.dispatcher.current.info.title.slice(0,40)}](${e.dispatcher.current.info.uri}) [${KongouDispatcher.humanizeTime(e.dispatcher.current.info.length)}]`},{name:"• Up next",value:t.map((e,t)=>`**${t+1})** [${e.info.title.slice(0,40)}](${e.info.uri}) (Requested by \`${e.info.requester?e.info.requester.name:"Unknow"}\`)`).join("\n")},{name:"• Settings",value:`Repeat Mode: ${e.dispatcher.repeat} | Dj: <@${e.dispatcher.metadata.dj}> | Volume: ${100*e.dispatcher.player.filters.volume}`}],color:"#3A871F"}],components:[{components:[{customId:"save_pl",label:"Save Queue",style:3,type:"BUTTON"},{customId:"clear_queue",label:"Clear Queue",style:4,type:"BUTTON"},{emoji:"⏮",customId:"back_queue",style:2,type:"BUTTON"},{emoji:"⏭",customId:"next_queue",style:2,type:"BUTTON"}],type:"ACTION_ROW"}]}),r=e=>"back_queue"===e.customId||"next_queue"===e.customId,s=i.createMessageComponentCollector({filter:r,time:12e4});s.on("collect",async t=>{if(t.deleteReply(),t.user.id===e.author.id){if("back_queue"===t.customId){if(a-=6,n-=1,(u-=6)<0)return;if(n<1)return;let t=e.dispatcher.queue.map((e,t)=>`**${t+1})** [${e.info.title.slice(0,40)}](https://green-bot.app) (Requested by \`${e.info.requester?e.info.requester.name:"Unknow"}\`)`).slice(u,a).join("\n");i.edit({embeds:[{author:{name:`Queue for ${e.guild.name} (${e.dispatcher.queue.length} songs)`,icon_url:e.author.displayAvatarURL({size:512,format:"png"})},fields:[{name:"• Now playing",value:`[${e.dispatcher.current.info.title.slice(0,40)}](${e.dispatcher.current.info.uri}) [${KongouDispatcher.humanizeTime(e.dispatcher.current.info.length)}]`},{name:"• Up next",value:t},{name:"• Settings",value:`Repeat Mode: ${e.dispatcher.repeat} | Dj: <@${e.dispatcher.metadata.dj}> | Volume: ${100*e.dispatcher.player.filters.volume}`}],color:"#3A871F"}],components:[{components:[{customId:"save_pl",label:"Save Queue",style:3,type:"BUTTON"},{customId:"clear_queue",label:"Clear Queue",style:4,type:"BUTTON"},{emoji:"⏮",customId:"back_queue",style:2,type:"BUTTON"},{emoji:"⏭",customId:"next_queue",style:2,type:"BUTTON"}],type:"ACTION_ROW"}]})}if("next_queue"===t.customId){if(u+=6,n+=1,(a+=6)>e.dispatcher.queue.length+6)return;if(u<0)return;let t=e.dispatcher.queue.map((e,t)=>`**${t+1})** [${e.info.title.slice(0,40)}](${e.info.uri}) (Requested by \`${e.info.requester?e.info.requester.name:"Unknow"}\`)`).slice(u,a).join("\n");i.edit({embeds:[{author:{name:`Queue for ${e.guild.name} (${e.dispatcher.queue.length} songs)`,icon_url:e.author.displayAvatarURL({size:512,format:"png"})},fields:[{name:"• Now playing",value:`[${e.dispatcher.current.info.title.slice(0,40)}](${e.dispatcher.current.info.uri}) [${KongouDispatcher.humanizeTime(e.dispatcher.current.info.length)}]`},{name:"• Up next",value:t},{name:"• Settings",value:`Repeat Mode: ${e.dispatcher.repeat} | Dj: <@${e.dispatcher.metadata.dj}> | Volume: ${100*e.dispatcher.player.filters.volume}`}],color:"#3A871F"}],components:[{components:[{customId:"save_pl",label:"Save Queue",style:3,type:"BUTTON"},{customId:"clear_queue",label:"Clear Queue",style:4,type:"BUTTON"},{emoji:"⏮",customId:"back_queue",style:2,type:"BUTTON"},{emoji:"⏭",customId:"next_queue",style:2,type:"BUTTON"}],type:"ACTION_ROW"}]})}}}),s.on("end",async t=>{i.edit({embeds:[{author:{name:`Queue for ${e.guild.name} (${e.dispatcher.queue.length} songs)`,icon_url:e.author.displayAvatarURL({size:512,format:"png"})},fields:[{name:"• Now playing",value:`[${e.dispatcher.current.info.title.slice(0,40)}](${e.dispatcher.current.info.uri}) [${KongouDispatcher.humanizeTime(e.dispatcher.current.info.length)}]`},{name:"• Up next",value:e.dispatcher.queue.slice(0,6).map((e,t)=>`**${t+1})** [${e.info.title.slice(0,40)}](${e.info.uri}) (Requested by \`${e.info.requester?e.info.requester.name:"Unknow"}\`)`).join("\n")},{name:"• Settings",value:`Repeat Mode: ${e.dispatcher.repeat} | Dj: <@${e.dispatcher.metadata.dj}> | Volume: ${100*e.dispatcher.player.filters.volume}`}],color:"#3A871F"}],components:[{components:[{customId:"save_pl",label:"Save Queue",style:3,type:"BUTTON"},{customId:"clear_queue",label:"Clear Queue",style:4,type:"BUTTON"},{emoji:"⏮",disabled:!0,customId:"back_queue",style:2,type:"BUTTON"},{emoji:"⏭",disabled:!0,customId:"next_queue",style:2,type:"BUTTON"}],type:"ACTION_ROW"}]})})}else{const t=e.dispatcher.queue;e.channel.send({embeds:[{author:{name:`Queue for ${e.guild.name} (${e.dispatcher.queue.length} songs)`,icon_url:e.author.displayAvatarURL({size:512,format:"png"})},fields:[{name:"• Now playing",value:`[${e.dispatcher.current.info.title.slice(0,40)}](${e.dispatcher.current.info.uri}) [${KongouDispatcher.humanizeTime(e.dispatcher.current.info.length)}]`},{name:"• Up next",value:e.dispatcher.queue.length>0?t.map((e,t)=>`**${t+1})** [${e.info.title.slice(0,50)}](${e.info.uri}) (Requested by \`${e.info.requester?e.info.requester.name:"Unknow"}\`)`).join("\n"):`There are no songs in the queue yet! Add one using \`${e.guildDB.prefix}play <music>\`!`},{name:"• Settings",value:`Repeat Mode: ${e.dispatcher.repeat} | Dj: <@${e.dispatcher.metadata.dj}> | Volume: ${100*e.dispatcher.player.filters.volume}`}],color:"#3A871F"}],components:[{components:[{customId:"save_pl",label:"Save Queue",style:3,type:"BUTTON"},{customId:"clear_queue",label:"Clear Queue",style:4,type:"BUTTON"}],type:"ACTION_ROW"}]})}}}module.exports=Queue;