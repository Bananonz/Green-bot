const KongouCommand=require("../../abstract/KongouCommand.js");class Skip extends KongouCommand{get name(){return"skip"}get description(){return"Skips the currently playing song"}get aliases(){return["next","s"]}get category(){return"Everyone Commands"}get playerCheck(){return{voice:!0,dispatcher:!0,channel:!0}}run({ctx:e}){if(0==e.dispatcher.queue.length&&"autoplay"!==e.dispatcher.repeat)return e.errorMessage(`Nothing next in the queue. Use \`${e.guildDB.prefix}queue\` to see the server's queue.\nWant to try autoplay? do \`${e.guildDB.prefix}autoplay\``);if(e.guild.me.voice.channel.members.filter(e=>!e.user.bot).size>=2&&e.guildDB.vote_skip)e.dispatcher.voting?e.errorMessage("Another vote for skipping the current track is already running."):e.reply({embeds:[{author:{name:`${e.author.username} requested to skip the current track! Vote!`,icon_url:e.author.displayAvatarURL({size:512,format:"png"}),url:"https://discord.gg/synAXZtQHM"},color:"#84207F"}],components:[{components:[{customId:"vote",style:3,type:"BUTTON",label:"Vote to skip!"}],type:"ACTION_ROW"}]}).then(t=>{let r=0,o=[];e.dispatcher.voting=!0;const s=function(e){return Math.round((e+1)/2)}(e.guild.me.voice.channel.members.filter(e=>!e.user.bot).size),a=e.channel.createMessageComponentCollector({filter:e=>"vote"===e.customId,time:6e4});a.on("collect",n=>{if(o.includes(n.member.id))return n.reply({embeds:[{description:"You have already voted!",color:"#C73829"}],ephemeral:!0});o.push(n.member.id),r++,n.reply({embeds:[{author:{name:`${n.member.user.username} voted to skip! (${r}/${s})`,icon_url:n.member.user.displayAvatarURL({size:512,format:"png"}),url:"https://discord.gg/synAXZtQHM"},color:"#84207F"}]}).then(()=>{n.fetchReply().then(e=>{setTimeout(()=>e?e.delete():null,5e3)})}),r===s&&(a.stop(),e.dispatcher.voting=!1,e.dispatcher.skip(),e.reply("**‚è© *Skipping* üëç**"),t.delete().catch(e=>{}))}),a.on("end",t=>{e.dispatcher&&e.dispatcher.voting&&(e.dispatcher.voting=!1),r!==s&&e.interaction.editReply({embeds:[{author:{name:"Vote cancelled! Please do the command again!",icon_url:e.author.displayAvatarURL({size:512,format:"png"}),url:"https://discord.gg/synAXZtQHM"},color:"#84207F"}],components:[{components:[{customId:"vote",style:3,disabled:!0,type:"BUTTON",label:"Vote to skip!"}],type:"ACTION_ROW"}]})})});else if(e.guildDB.dj_role&&e.dispatcher.metadata.dj!==e.member.id){if(e.guild.roles.cache.get(e.guildDB.dj_role)&&!e.member.roles.cache.has(e.guildDB.dj_role)&&!e.member.permissions.has("MANAGE_MESSAGES"))return e.errorMessage("You need to have the DJ role or the `Manage messages` permissions to use this command.");if(!e.guild.roles.cache.get(e.guildDB.dj_role)&&!e.member.permissions.has("MANAGE_MESSAGES"))return e.errorMessage("You need to have the DJ role or the `Manage messages` permissions to use this command.");e.dispatcher.skip(),e.reply("**‚è© *Skipping* üëç**")}else e.dispatcher.skip(),e.reply("**‚è© *Skipping* üëç**")}}module.exports=Skip;