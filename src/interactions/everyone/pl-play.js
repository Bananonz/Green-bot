const KongouCommand=require("../../abstract/KongouCommand.js"),userData=require("../../models/user");class Queue extends KongouCommand{get name(){return"pl-play"}get description(){return"Play a playlist"}get aliases(){return["pl-p","pl-play","pl-load","plp"]}get category(){return"Everyone Commands"}get playerCheck(){return{voice:!0}}get arguments(){return[{name:"playlist_name",description:"The name of the playlist you want to play",required:!0,type:3}]}async run({ctx:e}){const t=e.args[0].value,s=await e.client.mongoDB.getUser(e.author.id);if("liked-songs"===t){if(0==s.songs.length)return e.errorMessage("You don't have any liked song yet!");const t=e.client.shoukaku.getNode();if(!t)return e.errorMessage("No nodes are available yet! You can report this error is [Green bot Server](https://discord.gg/greenbot)");let a=await e.client.queue.create(e,t);e.successMessage(`Added [Your liked songs](https://green-bot.app) to the queue with **${s.songs.length}** tracks ${e.guildDB.auto_shuffle?"ðŸ”€ and automatically shuffled it":""}`),s.songs.forEach(e=>{a.queue.push(e)}),a.tracksAdded(),e.guildDB.auto_shuffle&&(e.dispatcher.queue=e.dispatcher.queue.sort(()=>Math.random()-.5)),setTimeout(()=>{a.playing||a.play()},1500)}else{if(!s||!s.playlists.find(e=>e.name===t))return e.errorMessage(`You don't have any playlist called **${t.slice(0,100)}** yet!`);if(!e.dispatcher){if(!e.member.voice.channel.joinable||!e.member.voice.channel.viewable)return e.errorMessage("I don't have the required permissions to join your voice channel! I need `View Channels`, `Connect` and `Speak` permissiondata. [Permissions Example](https://cdn.discordapp.com/attachments/904438715974287440/909076558558412810/unknown.png)\n If the problem persists, change the voice channel region to `Europe`");if(!e.member.voice.channel.speakable&&"GUILD_STAGE_VOICE"!==e.member.voice.channel.type)return e.errorMessage("I don't have the permission to speak in your voice channel.\n Please give me the permission to or check this guide to learn how to give me this permissions:\nhttps://guide.green-bot.app/frequent-issues/permissions");if(e.guildDB.vcs.length&&!e.guildDB.vcs.includes(e.member.voice.channelId))return e.errorMessage(e.guildDB.vcs.length>1?`I am not allowed to play music in your voice channel.\n Please join one of the following channels: ${e.guildDB.vcs.map(e=>`<#${e}>`).join(",")}`:`I can only play music in the <#${e.guildDB.vcs[0]}> channel.`)}const a=s.playlists.find(e=>e.name===t),n=e.client.shoukaku.getNode();if(!n)return e.errorMessage("No nodes are available yet! You can report this error is [Green bot Server](https://discord.gg/greenbot)");let r=await e.client.queue.create(e,n);e.successMessage(`Added [${a.name}](https://green-bot.app) to the queue with **${a.tracks.length}** tracks ${e.guildDB.auto_shuffle?"ðŸ”€ and automatically shuffled it":""}`),a.tracks.forEach(e=>{r.queue.push(e)}),r.tracksAdded(),e.guildDB.auto_shuffle&&(e.dispatcher.queue=e.dispatcher.queue.sort(()=>Math.random()-.5)),setTimeout(()=>{r.playing||r.play()},1500)}}}module.exports=Queue;